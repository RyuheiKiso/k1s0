# docker-compose.override.yaml.example
# このファイルを docker-compose.override.yaml にコピーして使用してください。
# 必要なサービスのコメントを解除して起動してください。

services:
  # --- system 層 ---
  # ポート割り当て:
  #   auth-go:    REST 8080, gRPC 50051
  #   auth-rust:  REST 8083, gRPC 50052
  #   config-go:  REST 8082, gRPC 50053
  #   config-rust: REST 8084, gRPC 50054
  #
  # auth-go:
  #   build:
  #     context: ./regions/system/server/go/auth
  #     dockerfile: Dockerfile
  #   profiles: [system]
  #   ports:
  #     - "8080:8080"
  #     - "50051:50051"
  #   environment:
  #     - CONFIG_PATH=/app/config/config.dev.yaml
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #     keycloak:
  #       condition: service_started
  #   volumes:
  #     - ./regions/system/server/go/auth/config:/app/config
  #   healthcheck:
  #     test: ["CMD-SHELL", "curl -f http://localhost:8080/healthz || exit 1"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #
  # auth-rust:
  #   build:
  #     context: ./regions/system/server/rust/auth
  #     dockerfile: Dockerfile
  #   profiles: [system]
  #   ports:
  #     - "8083:8080"
  #     - "50052:50051"
  #   environment:
  #     - CONFIG_PATH=/app/config/config.dev.yaml
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #     keycloak:
  #       condition: service_started
  #   volumes:
  #     - ./regions/system/server/rust/auth/config:/app/config
  #   healthcheck:
  #     test: ["CMD-SHELL", "curl -f http://localhost:8080/healthz || exit 1"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #
  # config-go:
  #   build:
  #     context: ./regions/system/server/go/config
  #     dockerfile: Dockerfile
  #   profiles: [system]
  #   ports:
  #     - "8082:8080"
  #     - "50053:50051"
  #   environment:
  #     - CONFIG_PATH=/app/config/config.dev.yaml
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #     keycloak:
  #       condition: service_started
  #   volumes:
  #     - ./regions/system/server/go/config/config:/app/config
  #   healthcheck:
  #     test: ["CMD-SHELL", "curl -f http://localhost:8080/healthz || exit 1"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #
  # config-rust:
  #   build:
  #     context: ./regions/system/server/rust/config
  #     dockerfile: Dockerfile
  #   profiles: [system]
  #   ports:
  #     - "8084:8080"
  #     - "50054:50051"
  #   environment:
  #     - CONFIG_PATH=/app/config/config.dev.yaml
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #     keycloak:
  #       condition: service_started
  #   volumes:
  #     - ./regions/system/server/rust/config/config:/app/config
  #   healthcheck:
  #     test: ["CMD-SHELL", "curl -f http://localhost:8080/healthz || exit 1"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # --- service 層 ---
  # order-server:
  #   build:
  #     context: ./regions/service/order/server/go
  #     dockerfile: Dockerfile
  #   profiles: [service]
  #   ports:
  #     - "8082:8080"
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #     kafka:
  #       condition: service_healthy
  #   volumes:
  #     - ./regions/service/order/server/go/config:/app/config

  # --- API Gateway ---
  # kong:
  #   image: kong:3.7
  #   profiles: [infra]
  #   environment:
  #     KONG_DATABASE: postgres
  #     KONG_PG_HOST: postgres
  #     KONG_PG_DATABASE: kong
  #     KONG_PG_USER: dev
  #     KONG_PG_PASSWORD: dev
  #     KONG_PROXY_ACCESS_LOG: /dev/stdout
  #     KONG_ADMIN_ACCESS_LOG: /dev/stdout
  #     KONG_PROXY_ERROR_LOG: /dev/stderr
  #     KONG_ADMIN_ERROR_LOG: /dev/stderr
  #     KONG_ADMIN_LISTEN: "0.0.0.0:8001"
  #   ports:
  #     - "8000:8000"
  #     - "8001:8001"
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
