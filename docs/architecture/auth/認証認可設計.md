# 認証認可設計

k1s0 における認証・認可・シークレット管理の設計を定義する。
Tier アーキテクチャの詳細は [tier-architecture.md](../../architecture/overview/tier-architecture.md) を参照。

## 技術スタック

| コンポーネント       | 技術                     | バージョン |
| -------------------- | ------------------------ | ---------- |
| 認証基盤             | Keycloak（セルフホスト） | 26.0 (LTS) |
| API Gateway          | Kong                     | 3.8        |
| サービスメッシュ     | Istio                    | 1.24       |
| シークレット管理     | HashiCorp Vault          | 1.17       |
| BFF Proxy            | Go (net/http)            | ---        |
| セッションストア     | Redis Sentinel           | ---        |

## 基本方針

- 認証基盤は **Keycloak 26.0**（セルフホスト、LTS）を使用する
- クライアント別に最適な OAuth 2.0 フローを採用する
- サービス間通信は **mTLS**（Istio STRICT モード）で保護する
- API Gateway（Kong）で JWT 検証を一元化する
- アプリケーションレベルの認可は **RBAC** で制御する
- シークレット管理は **HashiCorp Vault** で一元化する

---

## 詳細設計ドキュメント

各設計の詳細は以下の分割ドキュメントを参照。

| ドキュメント | 内容 |
| --- | --- |
| [認証設計.md](認証設計.md) | D-001: OAuth 2.0/OIDC（Keycloak・LDAP・クライアントフロー・JWT Claims・トークン管理） |
| [JWT設計.md](./JWT設計.md) | D-002: JWT 公開鍵ローテーション（JWKS 方式・Go/Rust 実装） |
| [サービス間認証設計.md](サービス間認証設計.md) | D-003: mTLS（Istio・Tier 間 AuthorizationPolicy） |
| [RBAC設計.md](./RBAC設計.md) | D-005: アプリケーションレベル RBAC（Role/Permission/Resource・パーミッションマトリクス） |
| [Vault設計.md](../../infrastructure/security/Vault設計.md) | D-006: Vault 戦略（認証方式・シークレットエンジン・パス体系・監査ログ） |

> **D-004: Kong 認証フロー** は [APIゲートウェイ設計.md](../api/APIゲートウェイ設計.md) を参照。

---

## 関連ドキュメント

- [tier-architecture.md](../../architecture/overview/tier-architecture.md) -- Tier アーキテクチャの詳細
- [config.md](../../cli/config/config設計.md) -- config.yaml スキーマと環境別管理
- [kubernetes設計.md](../../infrastructure/kubernetes/kubernetes設計.md) -- Namespace・NetworkPolicy 設計
- [helm設計.md](../../infrastructure/kubernetes/helm設計.md) -- Helm Chart・Vault Agent Injector
- [terraform設計.md](../../infrastructure/terraform/terraform設計.md) -- Terraform モジュール（vault/ モジュール）
- [インフラ設計.md](../../infrastructure/overview/インフラ設計.md) -- オンプレミスインフラ全体構成
- [API設計.md](../api/API設計.md) -- REST API・gRPC・GraphQL・レート制限
- [APIゲートウェイ設計.md](../api/APIゲートウェイ設計.md) -- Kong 構成管理
- [サービスメッシュ設計.md](../../infrastructure/service-mesh/サービスメッシュ設計.md) -- Istio 設計・耐障害性
- [可観測性設計.md](../observability/可観測性設計.md) -- 監視・ログ・トレース設計
