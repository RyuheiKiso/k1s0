# ディレクトリ構成図

k1s0 モノリポの理想的なディレクトリ構成を定義する。
階層アーキテクチャの詳細は [tier-architecture.md](tier-architecture.md) を参照。

## 全体構成

```
k1s0/
├── CLI/                        # Rust製の対話式CLIツール
├── regions/                    # system / business / service の3階層
│   ├── system/                 # 全プロジェクト横断の共通基盤
│   ├── business/               # 部門・業務領域ごとの共通基盤
│   └── service/                # 個別サービスの実装
├── api/                        # プロジェクト横断の API 定義
│   ├── proto/                  # 共有プロトコル定義（サービス間で共有）
│   │   ├── k1s0/
│   │   │   ├── event/          # イベント定義（メッセージング設計.md 参照）
│   │   │   │   ├── system/
│   │   │   │   ├── business/
│   │   │   │   └── service/
│   │   │   └── system/
│   │   │       ├── {サービス名}/  # 各サービスの proto 定義
│   │   │       │   └── v1/
│   │   │       │       └── {サービス名}.proto
│   │   │       └── common/
│   │   │           └── v1/
│   │   │               ├── types.proto           # 共通型（Pagination, Timestamp 等）
│   │   │               └── event_metadata.proto  # イベントメタデータ
│   │   ├── buf.yaml            # buf 設定（lint・breaking change 検出）
│   │   └── buf.gen.yaml        # buf コード生成設定
│   └── graphql/                # GraphQL スキーマ定義
│       └── schema.graphql
├── infra/                      # インフラ定義（IaC）
├── docs/                       # ドキュメント
├── scripts/                    # ユーティリティスクリプト
├── .devcontainer/
│   └── devcontainer.json       # Dev Container 設定
├── .github/
│   └── workflows/              # CI/CD パイプライン
│       ├── ci.yaml             # 共通 CI
│       ├── deploy.yaml         # 共通デプロイ
│       ├── tauri-build.yaml    # Tauri GUI クロスプラットフォームビルド
│       ├── {サービス名}-ci.yaml     # サービスごとの CI
│       ├── {サービス名}-deploy.yaml # サービスごとのデプロイ
│       ├── integration-test.yaml   # 統合テスト
│       ├── proto.yaml              # proto lint・生成
│       └── security.yaml           # セキュリティスキャン
├── analysis_options.yaml       # Dart 解析設定
├── eslint.config.mjs           # ESLint 設定
├── rustfmt.toml                # Rust フォーマッタ設定
├── docker-compose.yaml         # ローカル開発用
└── README.md
```

---

## CLI

CLI バイナリ・Tauri GUI・共有ライブラリの 3 コンポーネントで構成する。詳細は [TauriGUI設計](../../cli/gui/TauriGUI設計.md) を参照。

```
CLI/
├── Cargo.toml                              # workspace メンバー定義
├── crates/
│   ├── k1s0-core/                          # 共有ライブラリクレート（CLI・GUI 共用）
│   │   ├── Cargo.toml
│   │   └── src/
│   │       ├── lib.rs
│   │       ├── commands/                   # init, generate, build, test, deploy
│   │       │   ├── init.rs                 # プロジェクト初期化
│   │       │   ├── generate/               # ひな形生成
│   │       │   │   ├── mod.rs              # エントリーポイント（run + ステートマシン）
│   │       │   │   ├── types.rs            # 型定義（Kind, Tier, Language 等）
│   │       │   │   ├── config_types.rs     # 設定型定義
│   │       │   │   ├── execute.rs          # 生成実行・テンプレートエンジン統合
│   │       │   │   ├── scaffold.rs         # インラインひな形生成
│   │       │   │   ├── navigation.rs       # ナビゲーション生成
│   │       │   │   └── retry.rs            # リトライ処理
│   │       │   ├── build.rs                # ビルド
│   │       │   ├── test_cmd.rs             # テスト実行
│   │       │   ├── deploy.rs               # デプロイ
│   │       │   └── validate/               # バリデーションコマンド
│   │       ├── config/                     # CLI設定の読み込み
│   │       ├── template/                   # Tera テンプレート処理
│   │       ├── progress.rs                 # プログレスバー
│   │       └── validation.rs               # バリデーション
│   ├── k1s0-cli/                           # CLI バイナリクレート
│   │   ├── Cargo.toml
│   │   ├── src/
│   │   │   ├── main.rs                     # dialoguer による対話 UI
│   │   │   ├── lib.rs
│   │   │   ├── prompt/                     # 対話式プロンプト（dialoguer）
│   │   │   ├── commands/                   # CLI 固有コマンド
│   │   │   ├── config/                     # CLI 固有設定
│   │   │   └── template/                   # CLI 固有テンプレート処理
│   │   ├── templates/                      # scaffold用テンプレート（CLI・GUI 共有）
│   │   │   ├── server/
│   │   │   │   ├── go/
│   │   │   │   └── rust/
│   │   │   ├── client/
│   │   │   │   ├── react/
│   │   │   │   └── flutter/
│   │   │   ├── library/
│   │   │   │   ├── go/
│   │   │   │   ├── rust/
│   │   │   │   ├── typescript/
│   │   │   │   ├── dart/
│   │   │   │   └── database/
│   │   └── tests/                          # CLI テスト
│   └── k1s0-gui/                           # Tauri GUI アプリケーション
│       ├── Cargo.toml                      # k1s0-core を依存に持つ
│       ├── src/
│       │   ├── main.rs                     # Tauri エントリーポイント
│       │   └── commands.rs                 # #[tauri::command] 定義
│       ├── tauri.conf.json
│       └── ui/                             # React フロントエンド
│           ├── src/
│           │   ├── App.tsx
│           │   ├── pages/                  # メニュー別ページ
│           │   └── components/
│           ├── package.json
│           └── tsconfig.json
└── Cargo.lock
```

---

## regions

### system（最上位 Tier）

全プロジェクトで横断的に利用する共通基盤。client は UI を持たない共通 SDK パッケージとして配置する。

```
regions/system/
├── server/                        # 各サービスは Rust で実装（BFF Proxy は Go）
│   ├── rust/
│   │   └── {サービス名}/
│   │       └── （Rust サーバー構成）
│   └── go/
│       └── bff-proxy/             # BFF Proxy（Go 実装）
│           └── （Go サーバー構成）
├── client/                        # UI を持たない共通 SDK パッケージ
│   ├── flutter/
│   │   └── system_client/         # Flutter 共通 SDK（認証・API クライアント・共通 Widget）
│   └── react/
│       └── system-client/         # React 共通 SDK（認証・API クライアント・共通 Component）
├── library/
│   ├── go/
│   │   ├── auth/                  # JWT 検証・OAuth2
│   │   ├── audit-client/          # 監査クライアント
│   │   ├── cache/                 # キャッシュ
│   │   ├── circuit-breaker/       # サーキットブレーカー
│   │   ├── config/                # YAML 設定読み込み
│   │   ├── correlation/           # 相関 ID 管理
│   │   ├── distributed-lock/      # 分散ロック
│   │   ├── dlq/                   # Kafka DLQ クライアント
│   │   ├── encryption/            # 暗号化
│   │   ├── event-bus/             # イベントバス
│   │   ├── eventstore/            # イベントストアクライアント
│   │   ├── featureflag/           # フィーチャーフラグクライアント
│   │   ├── file-client/           # ファイルクライアント
│   │   ├── graphql-client/        # GraphQL クライアント
│   │   ├── health/                # ヘルスチェック
│   │   ├── idempotency/           # 冪等性
│   │   ├── kafka/                 # Kafka 接続管理
│   │   ├── messaging/             # イベント発行・購読
│   │   ├── migration/             # マイグレーション
│   │   ├── notification-client/   # 通知クライアント
│   │   ├── outbox/                # トランザクショナルアウトボックス
│   │   ├── pagination/            # ページネーション
│   │   ├── quota-client/          # クォータクライアント
│   │   ├── ratelimit-client/      # レートリミットクライアント
│   │   ├── resiliency/            # レジリエンシー
│   │   ├── retry/                 # リトライ
│   │   ├── saga/                  # Saga パターンクライアント
│   │   ├── scheduler-client/      # スケジューラクライアント
│   │   ├── schemaregistry/        # Schema Registry クライアント
│   │   ├── search-client/         # 検索クライアント
│   │   ├── serviceauth/           # サービス間 OAuth2 認証
│   │   ├── session-client/        # セッションクライアント
│   │   ├── telemetry/             # OpenTelemetry 初期化
│   │   ├── tenant-client/         # テナントクライアント
│   │   ├── test-helper/           # テストヘルパー
│   │   ├── tracing/               # トレーシング
│   │   ├── validation/            # バリデーション
│   │   ├── vault-client/          # Vault クライアント
│   │   ├── webhook-client/        # Webhook クライアント
│   │   └── websocket/             # WebSocket
│   ├── rust/
│   │   ├── auth/                  # JWT 検証・OAuth2
│   │   ├── audit-client/          # 監査クライアント
│   │   ├── cache/                 # キャッシュ
│   │   ├── circuit-breaker/       # サーキットブレーカー
│   │   ├── config/                # YAML 設定読み込み
│   │   ├── correlation/           # 相関 ID 管理
│   │   ├── distributed-lock/      # 分散ロック
│   │   ├── dlq/                   # Kafka DLQ クライアント
│   │   ├── encryption/            # 暗号化
│   │   ├── event-bus/             # イベントバス
│   │   ├── eventstore/            # イベントストアクライアント
│   │   ├── featureflag/           # フィーチャーフラグクライアント
│   │   ├── file-client/           # ファイルクライアント
│   │   ├── graphql-client/        # GraphQL クライアント
│   │   ├── health/                # ヘルスチェック
│   │   ├── idempotency/           # 冪等性
│   │   ├── kafka/                 # Kafka 接続管理
│   │   ├── messaging/             # イベント発行・購読
│   │   ├── migration/             # マイグレーション
│   │   ├── notification-client/   # 通知クライアント
│   │   ├── outbox/                # トランザクショナルアウトボックス
│   │   ├── pagination/            # ページネーション
│   │   ├── quota-client/          # クォータクライアント
│   │   ├── ratelimit-client/      # レートリミットクライアント
│   │   ├── resiliency/            # レジリエンシー
│   │   ├── retry/                 # リトライ
│   │   ├── saga/                  # Saga パターンクライアント
│   │   ├── scheduler-client/      # スケジューラクライアント
│   │   ├── schemaregistry/        # Schema Registry クライアント
│   │   ├── search-client/         # 検索クライアント
│   │   ├── server-common/         # Rust サーバー共通コード
│   │   ├── serviceauth/           # サービス間 OAuth2 認証
│   │   ├── session-client/        # セッションクライアント
│   │   ├── telemetry/             # OpenTelemetry 初期化
│   │   ├── tenant-client/         # テナントクライアント
│   │   ├── test-helper/           # テストヘルパー
│   │   ├── tracing/               # トレーシング
│   │   ├── validation/            # バリデーション
│   │   ├── vault-client/          # Vault クライアント
│   │   ├── webhook-client/        # Webhook クライアント
│   │   └── websocket/             # WebSocket
│   ├── typescript/
│   │   ├── auth/                  # JWT 検証・OAuth2
│   │   ├── audit-client/          # 監査クライアント
│   │   ├── cache/                 # キャッシュ
│   │   ├── circuit-breaker/       # サーキットブレーカー
│   │   ├── config/                # YAML 設定読み込み
│   │   ├── correlation/           # 相関 ID 管理
│   │   ├── distributed-lock/      # 分散ロック
│   │   ├── dlq-client/            # Kafka DLQ クライアント
│   │   ├── encryption/            # 暗号化
│   │   ├── event-bus/             # イベントバス
│   │   ├── eventstore/            # イベントストアクライアント
│   │   ├── featureflag/           # フィーチャーフラグクライアント
│   │   ├── file-client/           # ファイルクライアント
│   │   ├── graphql-client/        # GraphQL クライアント
│   │   ├── health/                # ヘルスチェック
│   │   ├── idempotency/           # 冪等性
│   │   ├── kafka/                 # Kafka 接続管理
│   │   ├── messaging/             # イベント発行・購読
│   │   ├── migration/             # マイグレーション
│   │   ├── notification-client/   # 通知クライアント
│   │   ├── outbox/                # トランザクショナルアウトボックス
│   │   ├── pagination/            # ページネーション
│   │   ├── quota-client/          # クォータクライアント
│   │   ├── ratelimit-client/      # レートリミットクライアント
│   │   ├── resiliency/            # レジリエンシー
│   │   ├── retry/                 # リトライ
│   │   ├── saga/                  # Saga パターンクライアント
│   │   ├── scheduler-client/      # スケジューラクライアント
│   │   ├── schemaregistry/        # Schema Registry クライアント
│   │   ├── search-client/         # 検索クライアント
│   │   ├── serviceauth/           # サービス間 OAuth2 認証
│   │   ├── session-client/        # セッションクライアント
│   │   ├── telemetry/             # OpenTelemetry 初期化
│   │   ├── tenant-client/         # テナントクライアント
│   │   ├── test-helper/           # テストヘルパー
│   │   ├── tracing/               # トレーシング
│   │   ├── validation/            # バリデーション
│   │   ├── vault-client/          # Vault クライアント
│   │   ├── webhook-client/        # Webhook クライアント
│   │   └── websocket/             # WebSocket
│   ├── dart/
│   │   ├── auth/                  # JWT 検証・OAuth2
│   │   ├── audit_client/          # 監査クライアント
│   │   ├── cache/                 # キャッシュ
│   │   ├── circuit_breaker/       # サーキットブレーカー
│   │   ├── config/                # YAML 設定読み込み
│   │   ├── correlation/           # 相関 ID 管理
│   │   ├── distributed_lock/      # 分散ロック
│   │   ├── dlq_client/            # Kafka DLQ クライアント
│   │   ├── encryption/            # 暗号化
│   │   ├── event_bus/             # イベントバス
│   │   ├── eventstore/            # イベントストアクライアント
│   │   ├── featureflag/           # フィーチャーフラグクライアント
│   │   ├── file_client/           # ファイルクライアント
│   │   ├── graphql_client/        # GraphQL クライアント
│   │   ├── health/                # ヘルスチェック
│   │   ├── idempotency/           # 冪等性
│   │   ├── kafka/                 # Kafka 接続管理
│   │   ├── messaging/             # イベント発行・購読
│   │   ├── migration/             # マイグレーション
│   │   ├── notification_client/   # 通知クライアント
│   │   ├── outbox/                # トランザクショナルアウトボックス
│   │   ├── pagination/            # ページネーション
│   │   ├── quota_client/          # クォータクライアント
│   │   ├── ratelimit_client/      # レートリミットクライアント
│   │   ├── resiliency/            # レジリエンシー
│   │   ├── retry/                 # リトライ
│   │   ├── saga/                  # Saga パターンクライアント
│   │   ├── scheduler_client/      # スケジューラクライアント
│   │   ├── schemaregistry/        # Schema Registry クライアント
│   │   ├── search_client/         # 検索クライアント
│   │   ├── serviceauth/           # サービス間 OAuth2 認証
│   │   ├── session_client/        # セッションクライアント
│   │   ├── telemetry/             # OpenTelemetry 初期化
│   │   ├── tenant_client/         # テナントクライアント
│   │   ├── test_helper/           # テストヘルパー
│   │   ├── tracing/               # トレーシング
│   │   ├── validation/            # バリデーション
│   │   ├── vault_client/          # Vault クライアント
│   │   ├── webhook_client/        # Webhook クライアント
│   │   └── websocket/             # WebSocket
└── database/
    └── {データベース名}/           # 例: auth-db
        └── （データベース構成）
```

### business（中位 Tier）

部門名・業務領域ごとにディレクトリを切る。

```
regions/business/
└── {領域名}/                       # 例: accounting, fa
    ├── server/                    # 各サービスは Rust で実装
    │   └── rust/
    │       └── {サービス名}/
    │           └── （Rust サーバー構成）
    ├── client/
    │   ├── react/
    │   │   └── {アプリ名}/
    │   │       └── （React クライアント構成）
    │   └── flutter/
    │       └── {アプリ名}/
    │           └── （Flutter クライアント構成）
    ├── library/
    │   ├── go/
    │   │   └── {ライブラリ名}/
    │   │       └── （Go ライブラリ構成）
    │   ├── rust/
    │   │   └── {ライブラリ名}/
    │   │       └── （Rust ライブラリ構成）
    │   ├── ts/
    │   │   └── {ライブラリ名}/
    │   │       └── （TypeScript ライブラリ構成）
    │   ├── dart/
    │   │   └── {ライブラリ名}/
    │   │       └── （Dart ライブラリ構成）
    └── database/
        └── {データベース名}/
            └── （データベース構成）
```

### service（最下位 Tier）

実際にデプロイ・稼働する個別サービス。

```
regions/service/
└── {サービス名}/                   # 例: order, inventory
    ├── server/                    # Rust / Go を配置
    │   ├── rust/
    │   │   ├── （Rust サーバー構成）
    │   │   └── bff/               # GraphQL BFF（オプション。API設計.md の導入基準を満たす場合）
    │   │       └── （Rust BFF 構成）
    │   └── go/
    │       └── bff/               # BFF（Go 実装、オプション）
    │           └── （Go BFF 構成）
    ├── client/
    │   ├── react/
    │   │   └── （React クライアント構成）
    │   └── flutter/
    │       └── （Flutter クライアント構成）
    └── database/
        └── {データベース名}/
            └── （データベース構成）
```

---

## サーバー内部構成（クリーンアーキテクチャ）

### Rust サーバー構成

```
{サービス名}/
├── src/
│   ├── main.rs                     # エントリーポイント
│   ├── lib.rs                      # ライブラリエントリーポイント
│   ├── domain/                     # ドメイン層
│   │   ├── entity/                 # Entity・Value Object
│   │   ├── repository/             # Repository トレイト
│   │   └── service/                # ドメインサービス
│   ├── usecase/                    # ユースケース層
│   ├── adapter/                    # インターフェースアダプター層
│   │   ├── handler/                # REST ハンドラー
│   │   ├── grpc/                   # gRPC ハンドラー
│   │   ├── middleware/             # ミドルウェア（認証・ログ等）
│   │   └── repository/            # DB リポジトリ実装
│   ├── infrastructure/             # インフラストラクチャ層（フラット構成）
│   └── proto/                      # gRPC 生成コード
├── tests/                          # 統合テスト（ユニットテストは src/ 内に #[cfg(test)] で配置）
├── config/
│   ├── config.yaml                 # アプリケーション設定
│   ├── config.dev.yaml             # 開発環境設定
│   ├── config.staging.yaml         # ステージング環境設定
│   └── config.prod.yaml            # 本番環境設定
├── build.rs                        # proto ビルドスクリプト
├── Dockerfile
└── Cargo.toml
```

---

## クライアント内部構成

### React クライアント構成

```
{アプリ名}/
├── src/
│   ├── app/                        # ルーティング・レイアウト
│   ├── features/                   # 機能単位のモジュール
│   │   └── {機能名}/
│   │       ├── components/
│   │       ├── hooks/
│   │       ├── api/
│   │       └── types/
│   ├── components/                 # 共通UIコンポーネント
│   ├── hooks/                      # 共通フック
│   ├── lib/                        # ユーティリティ
│   └── types/                      # 共通型定義
├── tests/                          # テストコード（ソースと分離）
│   ├── unit/                       # ユニットテスト
│   ├── integration/                # 統合テスト
│   └── testutil/                   # テストヘルパー・モック
├── public/
├── package.json
└── Dockerfile
```

### Flutter クライアント構成

```
{アプリ名}/
├── lib/
│   ├── app/                        # ルーティング・テーマ
│   ├── features/                   # 機能単位のモジュール
│   │   └── {機能名}/
│   │       ├── presentation/
│   │       ├── application/
│   │       └── data/
│   ├── widgets/                    # 共通ウィジェット
│   └── utils/                      # ユーティリティ
├── test/                           # テストコード（ソースと分離）
│   ├── unit/                       # ユニットテスト
│   ├── widget/                     # ウィジェットテスト
│   └── testutil/                   # テストヘルパー・モック
├── pubspec.yaml
└── Dockerfile
```

---

## ライブラリ内部構成

### Rust ライブラリ構成

```
{ライブラリ名}/
├── src/
│   ├── lib.rs                      # エントリーポイント
│   ├── {モジュール名}/             # 機能単位のモジュール
│   │   ├── mod.rs
│   │   └── *.rs
│   └── internal/                   # 非公開の内部実装（pub(crate)）
│       └── *.rs
├── tests/                          # 統合テスト・テストヘルパーを格納（ユニットテストは src/ 内に #[cfg(test)] で配置）
│   ├── integration/                # 統合テスト
│   └── testutil/                   # テストヘルパー・フィクスチャ
└── Cargo.toml
```

### TypeScript ライブラリ構成

```
{ライブラリ名}/
├── src/
│   ├── index.ts                    # エントリーポイント
│   └── {モジュール名}/             # 機能単位のモジュール
│       └── *.ts
├── tests/
│   ├── unit/                       # ユニットテスト
│   └── testutil/                   # テストヘルパー・モック
├── package.json
└── tsconfig.json
```

### Dart ライブラリ構成

```
{ライブラリ名}/
├── lib/
│   ├── {ライブラリ名}.dart          # エントリーポイント
│   └── src/                        # 内部実装
│       └── *.dart
├── test/
│   ├── unit/                       # ユニットテスト
│   └── testutil/                   # テストヘルパー・モック
├── pubspec.yaml
└── analysis_options.yaml
```

## データベース構成

```
{データベース名}/
├── migrations/                     # マイグレーションファイル（連番管理）
│   ├── 001_create_xxx.up.sql
│   └── 001_create_xxx.down.sql
└── sqlx.toml                       # sqlx 設定
```

RDBMS は階層・サービスの要件に応じて PostgreSQL / MySQL / SQLite から選択する。

---

## infra

```
infra/
├── terraform/                      # インフラのコード管理
│   ├── environments/
│   │   ├── dev/
│   │   ├── staging/
│   │   └── prod/
│   └── modules/
├── helm/                           # Kubernetes マニフェストテンプレート
│   ├── charts/
│   │   └── k1s0-common/            # Library Chart（共通テンプレート）
│   │       ├── Chart.yaml
│   │       ├── values.yaml
│   │       └── templates/
│   │           ├── _deployment.tpl
│   │           ├── _service.tpl
│   │           ├── _hpa.tpl
│   │           ├── _pdb.tpl
│   │           ├── _configmap.tpl
│   │           ├── _ingress.tpl
│   │           ├── _vault-annotations.tpl
│   │           └── _helpers.tpl
│   └── services/
│       ├── system/
│       │   └── {サービス名}/        # 例: auth
│       │       ├── Chart.yaml
│       │       ├── values.yaml
│       │       ├── values-dev.yaml
│       │       ├── values-staging.yaml
│       │       ├── values-prod.yaml
│       │       └── templates/
│       ├── business/
│       │   └── {領域名}/
│       │       └── {サービス名}/
│       │           └── （同上）
│       └── service/
│           └── {サービス名}/
│               └── （同上）
├── ansible/                        # サーバー構成管理・プロビジョニング
├── kong/                           # Kong API Gateway 設定
│   ├── kong.yaml                   # メイン設定ファイル（decK 形式）
│   ├── kong.dev.yaml               # 開発環境設定
│   ├── plugins/                    # プラグイン設定
│   │   ├── global.yaml             # グローバルプラグイン
│   │   └── auth.yaml               # 認証プラグイン
│   └── services/                   # Tier 別サービス定義
│       ├── system.yaml
│       ├── business.yaml
│       └── service.yaml
├── docker/                         # 共通 Docker 設定
│   ├── base-images/
│   ├── init-db/                    # PostgreSQL 初期化スクリプト
│   ├── keycloak/                   # Keycloak 設定
│   ├── kong/                       # Kong 設定
│   ├── prometheus/                 # Prometheus 設定ファイル
│   ├── grafana/                    # Grafana プロビジョニング設定
│   ├── loki/                       # Loki 設定
│   ├── promtail/                   # Promtail 設定
│   └── vault/                      # Vault 設定
├── istio/                          # サービスメッシュ CRD 定義（kubectl apply または Terraform kubernetes_manifest で管理。Istio 本体の Helm デプロイは terraform設計.md を参照）
│   ├── gateway.yaml
│   ├── virtual-service.yaml
│   ├── authorizationpolicy.yaml    # Istio 認可ポリシー
│   ├── peerauthentication.yaml     # Istio ピア認証
│   ├── destinationrules/           # デスティネーションルール
│   ├── fault-injection/            # フォールトインジェクション
│   ├── flagger/                    # Flagger（プログレッシブデリバリー）
│   └── virtualservices/            # 仮想サービス定義
├── keycloak/                       # Keycloak 認証基盤設定
├── kubernetes/                     # Kubernetes マニフェスト
├── local/                          # ローカル開発設定
├── messaging/                      # メッセージング設定（Kafka 等）
├── observability/                  # 可観測性設定
└── vault/                          # HashiCorp Vault 設定
```

---


## docs

```
docs/
├── architecture/
│   ├── api/          # API設計（REST, gRPC, GraphQL, proto, ゲートウェイ）
│   ├── auth/         # 認証設計（JWT, RBAC, サービス間認証）
│   ├── conventions/  # コーディング規約
│   ├── messaging/    # メッセージング設計
│   ├── observability/ # 可観測性設計（SLO, ログ, トレーシング, 監視アラート）
│   └── overview/     # 概要（tier-architecture, コンセプト, ディレクトリ構成図）
├── servers/          # サーバー設計書
├── libraries/        # ライブラリ設計書
├── templates/        # CLIコード生成テンプレート仕様
├── infrastructure/   # インフラ設計（CI/CD, Docker, K8s, Terraform, Vault）
├── cli/              # CLI設計
└── diagrams/         # 図
```

---

## 設計上の補足

- **環境変数の直接参照は禁止** — 各サーバーは `config/config.yaml` で設定を一元管理する。ただし config ローダー内での環境変数参照、テスト用のフィクスチャやヘルパー、Kubernetes の ConfigMap / Secret による注入、および CI/CD パイプラインでの環境変数設定は例外とする
- **依存方向は下位→上位の一方向のみ** — service → business → system。全 Tier から system への直接依存は許可される（service → system の直接通信は business を経由しなくてよい）。逆方向の依存は禁止。同階層間の通信は原則禁止だが、[tier-architecture.md](tier-architecture.md) に定義された例外ルール（system tier 内の共通基盤サービス間通信、business tier の同一ドメインコンテキスト内の同期通信、異なるドメインコンテキスト間のメッセージング経由の間接通信等）は許容される
- **データベースへのアクセスはその階層の server のみ** — 他階層のデータが必要な場合は API（gRPC 等）を経由する
- **system/client は UI を持たない共通 SDK** — system/client はエンドユーザー向けの画面アプリではなく、business/service client が import して使う共有ライブラリパッケージ（認証・API クライアント・共通 Widget・ルーティングガード）を提供する。エンドユーザー向けのアプリは business/service 以下で実装する
- **service tier に library がない理由** — service は独立してデプロイ・稼働する最小単位であり、他サービスとコードを共有しない。複数サービスで共通化すべきコードが生じた場合は、上位層（business または system）の library に昇格させる
- **ソースコードとテストコードの分離** — テストコードは `tests/`（Flutter / Dart は `test/`）ディレクトリに分離する。ただし Go はユニットテスト（`*_test.go`）をソースと同一パッケージに配置、Rust はユニットテスト（`#[cfg(test)]`）をソースと同一ファイルに配置する言語慣習に従い、統合テスト・テストヘルパーのみ `tests/` に分離する

## 関連ドキュメント

- [tier-architecture](tier-architecture.md)
- [API設計](../api/API設計.md)
- [proto設計](../api/proto設計.md) — Protobuf スキーマ定義・gRPC サービス定義・buf 設定
- [CLIフロー](../../cli/flow/CLIフロー.md)
- [docker-compose設計](../../infrastructure/docker/docker-compose設計.md)
- [テンプレート仕様-サーバー](../../templates/server/サーバー.md)
- [テンプレート仕様-クライアント](../../templates/client/クライアント.md)
- [テンプレート仕様-ライブラリ](../../templates/codegen/ライブラリ.md)
- [テンプレート仕様-データベース](../../templates/data/データベース.md)
- [テンプレートエンジン仕様](../../templates/engine/テンプレートエンジン仕様.md)
- [TauriGUI設計](../../cli/gui/TauriGUI設計.md)
