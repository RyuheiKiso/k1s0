# コーディング規約

k1s0 プロジェクトで使用する Linter・Formatter と共通ルールを定義する。

## 言語別ツール

### Go

| ツール          | 用途                         | 設定ファイル       |
| --------------- | ---------------------------- | ------------------ |
| gofmt           | コードフォーマット           | （組み込み）       |
| goimports       | import 整理 + フォーマット   | （組み込み）       |
| golangci-lint   | 静的解析                     | `.golangci.yaml`   |

#### .golangci.yaml

```yaml
run:
  timeout: 5m

linters:
  enable:
    - errcheck
    - govet
    - staticcheck
    - unused
    - gosimple
    - ineffassign
    - misspell
    - gocyclo
    - gocritic
    - revive
    - gosec

linters-settings:
  gocyclo:
    min-complexity: 15
  revive:
    rules:
      - name: exported
      - name: var-naming
      - name: unexported-return
```

### Rust

| ツール   | 用途               | 設定ファイル                |
| -------- | ------------------ | --------------------------- |
| rustfmt  | コードフォーマット | `rustfmt.toml`              |
| clippy   | 静的解析           | `Cargo.toml` の `[lints]`   |

#### rustfmt.toml

```toml
edition = "2021"
max_width = 100
tab_spaces = 4
use_field_init_shorthand = true
```

#### Cargo.toml（lints セクション）

```toml
[lints.clippy]
pedantic = { level = "warn", priority = -1 }
module_name_repetitions = "allow"
must_use_candidate = "allow"
```

### TypeScript

| ツール    | 用途               | 設定ファイル        |
| --------- | ------------------ | ------------------- |
| ESLint    | 静的解析           | `eslint.config.mjs` |
| Prettier  | コードフォーマット | `.prettierrc`       |

#### .prettierrc

```json
{
  "semi": true,
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 100,
  "tabWidth": 2
}
```

#### ESLint（概要）

- `@typescript-eslint/recommended` を基本として使用
- React プロジェクトでは `eslint-plugin-react-hooks` を追加
- `import/order` で import 順序を統一

### Dart

| ツール        | 用途               | 設定ファイル              |
| ------------- | ------------------ | ------------------------- |
| dart analyze  | 静的解析           | `analysis_options.yaml`   |
| dart format   | コードフォーマット | （組み込み）              |

#### analysis_options.yaml

```yaml
include: package:flutter_lints/flutter.yaml

linter:
  rules:
    - prefer_const_constructors
    - prefer_const_declarations
    - avoid_print
    - prefer_single_quotes
```

### Python（E2E テスト）

| ツール | 用途                  | 設定ファイル   |
| ------ | --------------------- | -------------- |
| Ruff   | Linter + Formatter    | `ruff.toml`    |
| mypy   | 型チェック            | `mypy.ini`     |

#### ruff.toml

```toml
line-length = 100
target-version = "py312"

[lint]
select = ["E", "F", "I", "UP", "B", "SIM"]
```

#### mypy.ini

```ini
[mypy]
python_version = 3.12
strict = true
warn_return_any = true
warn_unused_configs = true
```

## 命名規則

| 言語       | 変数・関数   | 型・構造体   | 定数                  | ファイル名      |
| ---------- | ------------ | ------------ | --------------------- | --------------- |
| Go         | camelCase    | PascalCase   | PascalCase            | snake_case.go   |
| Rust       | snake_case   | PascalCase   | SCREAMING_SNAKE_CASE  | snake_case.rs   |
| TypeScript | camelCase    | PascalCase   | SCREAMING_SNAKE_CASE  | kebab-case.ts   |
| Dart       | camelCase    | PascalCase   | camelCase             | snake_case.dart |
| Python     | snake_case   | PascalCase   | SCREAMING_SNAKE_CASE  | snake_case.py   |

## 共通方針

- 各言語の公式スタイルガイドに従う
- フォーマットは保存時に自動実行する（DevContainer の設定で統一）
- Linter の警告はすべて解消してからコミットする
- `// nolint`・`#[allow]`・`// eslint-disable` 等の抑制コメントには理由を明記する

## Pre-commit フック

Git の pre-commit フックで以下を自動実行する。

```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: go-lint
        name: Go Lint
        entry: golangci-lint run
        language: system
        files: '\.go$'
        pass_filenames: false

      - id: rust-fmt
        name: Rust Format Check
        entry: cargo fmt -- --check
        language: system
        files: '\.rs$'
        pass_filenames: false

      - id: rust-clippy
        name: Rust Clippy
        entry: cargo clippy -- -D warnings
        language: system
        files: '\.rs$'
        pass_filenames: false

      - id: ts-lint
        name: TypeScript Lint
        entry: npx eslint
        language: system
        files: '\.[tj]sx?$'

      - id: prettier
        name: Prettier
        entry: npx prettier --check
        language: system
        files: '\.(ts|tsx|js|jsx|json|yaml|yml)$'

      - id: python-lint
        name: Python Lint
        entry: ruff check
        language: system
        files: '\.py$'
```
