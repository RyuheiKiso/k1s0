# CLI仕様書

---

この文書は、プロジェクト生成・管理用CLIの仕様書です。
CLIはRust（Edition 2024）で実装され、プロジェクトの雛形作成や初期設定を簡素化します。

---

## 概要

- 目的：新規プロジェクトの雛形作成と基本設定を自動化し、開発開始までの手間を削減する。
- 実装言語：Rust（Edition 2024）
- 想定利用者：フロントエンド／バックエンド開発者、テンプレートを使いたいエンジニア

## コマンド一覧

- new
  - 概要：フロントエンドまたはバックエンド（＋任意でデータベース）プロジェクトを新規作成する。
  - サブタイプ：`frontend` / `backend`
  - フロントエンドテンプレート：`react`, `flutter`
  - バックエンドテンプレート：`rust`（Edition 2024, `axum` + `tokio`）, `go`（`gin`）
  - データベースオプション：`postgresql`
  - 代表的オプション
    - `--name <name>` : プロジェクト名
    - `--template <template>` : 使用するテンプレート名
    - `--db <db>` : データベースを有効化（例：`postgresql`）
    - `--path <path>` : 生成先ディレクトリ（省略時はCLI実行ファイルのあるディレクトリが既定）
  - 例
    - フロントエンド（React）作成：k1s0 new frontend --template react --name my-app
    - バックエンド（Rust + PostgreSQL）作成：k1s0 new backend --template rust --name my-service --db postgresql

  ## 対話式（Interactive）フロー

  - デフォルトの動作：CLIは対話式で進行します。ユーザーに対して順に質問し、入力や選択でプロジェクトを構成します。
  - フェーズ: プロジェクトタイプ選択
    - 最初に「フロントエンド」か「バックエンド」かを選択させます。選択に応じて以降の質問（テンプレート候補やデータベースの有無）が変わります。
    - 例：
      1) フロントエンド
      2) バックエンド
    - 補足：サブコマンドや `--template` 等で既にプロジェクト種別が明示されている場合は、このフェーズをスキップします。
  - 対話内容の例：
    - プロジェクト名（`--name` を未指定の場合）
    - テンプレート選択（`react` / `flutter` / `rust` / `go` など）
    - データベースの要否（`postgresql` を追加するか）
    - 生成先ディレクトリ（`--path` を省略した場合はCLI実行ファイルのあるディレクトリが既定）
    - 最終確認（生成前の確認と変更点のサマリ表示）
  - 使い勝手のポイント：
    - エンターで既定値を受け入れ可能にする。
    - 選択肢は番号選択または矢印キーで操作できるUIを用意する。

  ## 非対話モード（スクリプト実行向け）

  - フラグ：`--yes` または `--non-interactive`（提案名）。両方サポートすると互換性が取りやすい。
  - 動作：すべてのプロンプトをスキップし、コマンドライン引数（`--name`, `--template`, `--db`, `--path` など）で与えられた値を使用する。必要な引数が欠けている場合はエラーで終了する。
  - CIやスクリプトでの利用を想定する。

  ## 実装提案（対話式の技術的選択）

  - 対話UI：Rustでは `dialoguer` を利用すると簡単にプロンプト・選択UIが実現できる。
  - CLIパーサー：`clap` と組み合わせ、サブコマンドごとに `--non-interactive`/`--yes` を受け付ける。
  - テンプレート引数と対話の優先順位：明示的に指定された引数は対話の質問をスキップする。
  - 非対話モードでは必須引数の検証を厳密に行う。

## アーキテクチャ方針

- クリーンアーキテクチャ：層を分離し、依存関係を内側へ向ける。
- ドメイン駆動設計（DDD）：ビジネスルールを中心に据えた設計を推奨。
- テスト駆動開発（TDD）：テンプレートや生成コードにはテスト雛形を含める。

## 実装メモ（提案）

- CLIパーサー：`clap`を利用してサブコマンドとオプションを定義する。
- テンプレート管理：組み込みテンプレート＋外部テンプレートをサポート（git URL指定など）。
- 出力構成：生成されたプロジェクトにREADME、CIワークフロー、基本テストを含める。
