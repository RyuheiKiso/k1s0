<mxfile>
  <diagram name="Master Maintenance Architecture">
    <mxGraphModel dx="1422" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;Master Maintenance Server &amp;mdash; System Architecture&lt;/b&gt;" style="text;html=1;fontSize=22;fontStyle=0;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#1a1a2e;" vertex="1" parent="1">
          <mxGeometry x="300" y="15" width="600" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="subtitle" value="Rust (axum + tonic) | REST + gRPC Dual Protocol | Dynamic Table Management" style="text;html=1;fontSize=12;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="300" y="50" width="600" height="25" as="geometry"/>
        </mxCell>

        <!-- ============================================================ -->
        <!-- Layer 1: Client Layer (Green Swimlane) -->
        <!-- ============================================================ -->
        <mxCell id="layer-client" value="Client Layer" style="swimlane;startSize=30;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;arcSize=8;fontStyle=1;fontSize=14;swimlaneLine=0;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="90" width="1120" height="150" as="geometry"/>
        </mxCell>

        <!-- React Client -->
        <mxCell id="react-client" value="&lt;b&gt;React Client&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;Refine + Ant Design&lt;br&gt;CRUD UI / DataGrid&lt;br&gt;Import/Export&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;shadow=1;arcSize=12;verticalAlign=middle;spacingTop=2;spacingBottom=2;icon=mxgraph.aws4.client;" vertex="1" parent="layer-client">
          <mxGeometry x="100" y="45" width="200" height="85" as="geometry"/>
        </mxCell>

        <!-- Flutter Client -->
        <mxCell id="flutter-client" value="&lt;b&gt;Flutter Client&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;(optional)&lt;br&gt;Mobile / Desktop&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;shadow=1;arcSize=12;verticalAlign=middle;spacingTop=2;spacingBottom=2;dashed=1;" vertex="1" parent="layer-client">
          <mxGeometry x="370" y="45" width="180" height="85" as="geometry"/>
        </mxCell>

        <!-- GraphQL note in client layer -->
        <mxCell id="client-note" value="&lt;font style=&quot;font-size:10px;color:#666666;&quot;&gt;GraphQL queries / mutations&lt;br&gt;via async-graphql gateway&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;fillColor=none;strokeColor=none;" vertex="1" parent="layer-client">
          <mxGeometry x="700" y="55" width="200" height="40" as="geometry"/>
        </mxCell>

        <!-- ============================================================ -->
        <!-- Layer 2: API Layer (Blue Swimlane) -->
        <!-- ============================================================ -->
        <mxCell id="layer-api" value="API Layer" style="swimlane;startSize=30;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;arcSize=8;fontStyle=1;fontSize=14;swimlaneLine=0;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="280" width="1120" height="240" as="geometry"/>
        </mxCell>

        <!-- GraphQL Gateway -->
        <mxCell id="graphql-gw" value="&lt;b&gt;GraphQL Gateway&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;async-graphql&lt;br&gt;Federation / Stitching&lt;br&gt;(existing)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;shadow=1;arcSize=12;verticalAlign=middle;" vertex="1" parent="layer-api">
          <mxGeometry x="60" y="50" width="200" height="80" as="geometry"/>
        </mxCell>

        <!-- Master Maintenance Server (main component, larger box) -->
        <mxCell id="mm-server" value="&lt;b style=&quot;font-size:14px&quot;&gt;Master Maintenance Server&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px;color:#555&quot;&gt;Rust: axum + tonic&lt;br&gt;Dynamic Table Management&lt;/font&gt;" style="swimlane;startSize=55;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;arcSize=10;fontStyle=0;fontSize=12;swimlaneLine=1;shadow=1;html=1;" vertex="1" parent="layer-api">
          <mxGeometry x="330" y="40" width="460" height="175" as="geometry"/>
        </mxCell>

        <!-- REST API sub-component -->
        <mxCell id="rest-api" value="&lt;b&gt;REST API&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;axum handlers&lt;br&gt;port 8110&lt;br&gt;CRUD + Import/Export&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#6c8ebf;fontSize=11;shadow=0;arcSize=10;verticalAlign=middle;" vertex="1" parent="mm-server">
          <mxGeometry x="20" y="65" width="140" height="90" as="geometry"/>
        </mxCell>

        <!-- gRPC Service sub-component -->
        <mxCell id="grpc-svc" value="&lt;b&gt;gRPC Service&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;tonic server&lt;br&gt;port 9090&lt;br&gt;Service-to-Service&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bbdefb;strokeColor=#6c8ebf;fontSize=11;shadow=0;arcSize=10;verticalAlign=middle;" vertex="1" parent="mm-server">
          <mxGeometry x="170" y="65" width="140" height="90" as="geometry"/>
        </mxCell>

        <!-- ZEN Rule Engine (embedded) -->
        <mxCell id="zen-engine" value="&lt;b&gt;ZEN Rule Engine&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;embedded&lt;br&gt;validation rules&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;shadow=0;arcSize=10;verticalAlign=middle;" vertex="1" parent="mm-server">
          <mxGeometry x="325" y="65" width="120" height="90" as="geometry"/>
        </mxCell>

        <!-- Auth Server (external integration) -->
        <mxCell id="auth-server" value="&lt;b&gt;Auth Server&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;JWT Validation&lt;br&gt;RBAC&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;shadow=1;arcSize=12;verticalAlign=middle;" vertex="1" parent="layer-api">
          <mxGeometry x="870" y="50" width="180" height="80" as="geometry"/>
        </mxCell>

        <!-- ============================================================ -->
        <!-- Layer 3: Data Layer (Orange/Yellow Swimlane) -->
        <!-- ============================================================ -->
        <mxCell id="layer-data" value="Data Layer" style="swimlane;startSize=30;fillColor=#fff2cc;strokeColor=#d6b656;rounded=1;arcSize=8;fontStyle=1;fontSize=14;swimlaneLine=0;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="560" width="1120" height="240" as="geometry"/>
        </mxCell>

        <!-- PostgreSQL -->
        <mxCell id="postgres" value="&lt;b style=&quot;font-size:13px&quot;&gt;PostgreSQL 17&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px;color:#555&quot;&gt;master_maintenance schema&lt;/font&gt;" style="swimlane;startSize=42;fillColor=#fff2cc;strokeColor=#d6b656;rounded=1;arcSize=10;fontStyle=0;fontSize=12;swimlaneLine=1;shadow=1;html=1;" vertex="1" parent="layer-data">
          <mxGeometry x="60" y="45" width="500" height="160" as="geometry"/>
        </mxCell>

        <!-- Metadata Tables -->
        <mxCell id="metadata-tables" value="&lt;b&gt;Metadata Tables&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;table_definitions&lt;br&gt;column_definitions&lt;br&gt;validation_rules&lt;br&gt;import_export_configs&lt;/font&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;fillColor=#fff9e6;strokeColor=#d6b656;fontSize=10;shadow=0;size=12;verticalAlign=middle;spacingTop=5;" vertex="1" parent="postgres">
          <mxGeometry x="15" y="50" width="150" height="100" as="geometry"/>
        </mxCell>

        <!-- Target Business Tables -->
        <mxCell id="business-tables" value="&lt;b&gt;Target Business Tables&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;dynamic table access&lt;br&gt;via metadata config&lt;br&gt;(any schema/table)&lt;/font&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;fillColor=#fff9e6;strokeColor=#d6b656;fontSize=10;shadow=0;size=12;verticalAlign=middle;spacingTop=5;" vertex="1" parent="postgres">
          <mxGeometry x="178" y="50" width="150" height="100" as="geometry"/>
        </mxCell>

        <!-- Audit Logs -->
        <mxCell id="audit-logs" value="&lt;b&gt;Audit Logs&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;data_change_logs&lt;br&gt;user / timestamp&lt;br&gt;before/after diff&lt;/font&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;fillColor=#fff9e6;strokeColor=#d6b656;fontSize=10;shadow=0;size=12;verticalAlign=middle;spacingTop=5;" vertex="1" parent="postgres">
          <mxGeometry x="340" y="50" width="145" height="100" as="geometry"/>
        </mxCell>

        <!-- Kafka -->
        <mxCell id="kafka" value="&lt;b style=&quot;font-size:13px&quot;&gt;Kafka (Event Bus)&lt;/b&gt;" style="swimlane;startSize=32;fillColor=#f8cecc;strokeColor=#b85450;rounded=1;arcSize=10;fontStyle=0;fontSize=12;swimlaneLine=1;shadow=1;html=1;" vertex="1" parent="layer-data">
          <mxGeometry x="630" y="45" width="420" height="160" as="geometry"/>
        </mxCell>

        <!-- Kafka Topic -->
        <mxCell id="kafka-topic" value="&lt;b&gt;Topic&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px;font-family:monospace&quot;&gt;k1s0.system.&lt;br&gt;mastermaintenance.&lt;br&gt;data_changed.v1&lt;/font&gt;" style="shape=hexagon;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#b85450;fontSize=10;shadow=0;verticalAlign=middle;spacingTop=2;perimeter=hexagonPerimeter2;size=15;" vertex="1" parent="kafka">
          <mxGeometry x="30" y="50" width="170" height="90" as="geometry"/>
        </mxCell>

        <!-- Kafka Consumers -->
        <mxCell id="kafka-consumers" value="&lt;b&gt;Consumers&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Cache Invalidation&lt;br&gt;Search Index Update&lt;br&gt;Notification Service&lt;br&gt;Audit Trail Enrichment&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#b85450;fontSize=10;shadow=0;arcSize=10;verticalAlign=middle;" vertex="1" parent="kafka">
          <mxGeometry x="240" y="50" width="155" height="90" as="geometry"/>
        </mxCell>

        <!-- ============================================================ -->
        <!-- Connections -->
        <!-- ============================================================ -->

        <!-- React Client to GraphQL Gateway -->
        <mxCell id="conn-react-gw" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#82b366;fontSize=10;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="react-client" target="graphql-gw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="conn-react-gw-label" value="&lt;font style=&quot;font-size:9px;color:#82b366&quot;&gt;GraphQL&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;" vertex="1" connectable="0" parent="conn-react-gw">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- Flutter Client to GraphQL Gateway -->
        <mxCell id="conn-flutter-gw" style="endArrow=block;endFill=1;strokeWidth=1.5;strokeColor=#82b366;fontSize=10;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="flutter-client" target="graphql-gw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="conn-flutter-gw-label" value="&lt;font style=&quot;font-size:9px;color:#82b366&quot;&gt;GraphQL&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;" vertex="1" connectable="0" parent="conn-flutter-gw">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- GraphQL Gateway to Master Maintenance Server (REST) -->
        <mxCell id="conn-gw-mm" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#6c8ebf;fontSize=10;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.3;entryDx=0;entryDy=0;" edge="1" parent="1" source="graphql-gw" target="mm-server">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="conn-gw-mm-label" value="&lt;font style=&quot;font-size:9px;color:#6c8ebf&quot;&gt;HTTP / REST&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;" vertex="1" connectable="0" parent="conn-gw-mm">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- Master Maintenance Server to Auth Server -->
        <mxCell id="conn-mm-auth" style="endArrow=block;endFill=1;strokeWidth=2;strokeColor=#9673a6;fontSize=10;exitX=1;exitY=0.3;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="mm-server" target="auth-server">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="conn-mm-auth-label" value="&lt;font style=&quot;font-size:9px;color:#9673a6&quot;&gt;JWT Validation&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;" vertex="1" connectable="0" parent="conn-mm-auth">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- Master Maintenance Server to PostgreSQL -->
        <mxCell id="conn-mm-pg" style="endArrow=block;endFill=1;strokeWidth=2.5;strokeColor=#d6b656;fontSize=10;exitX=0.3;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="mm-server" target="postgres">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="conn-mm-pg-label" value="&lt;font style=&quot;font-size:9px;color:#d6b656&quot;&gt;&lt;b&gt;sqlx&lt;/b&gt; (metadata + business data)&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;" vertex="1" connectable="0" parent="conn-mm-pg">
          <mxGeometry x="-0.1" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- Master Maintenance Server to Kafka -->
        <mxCell id="conn-mm-kafka" style="endArrow=block;endFill=1;strokeWidth=2.5;strokeColor=#b85450;fontSize=10;exitX=0.8;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="mm-server" target="kafka">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="conn-mm-kafka-label" value="&lt;font style=&quot;font-size:9px;color:#b85450&quot;&gt;&lt;b&gt;rdkafka&lt;/b&gt; (data change events)&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;" vertex="1" connectable="0" parent="conn-mm-kafka">
          <mxGeometry x="-0.1" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- Kafka Topic to Consumers (internal) -->
        <mxCell id="conn-topic-consumers" style="endArrow=block;endFill=1;strokeWidth=1.5;strokeColor=#b85450;fontSize=10;" edge="1" parent="kafka" source="kafka-topic" target="kafka-consumers">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ============================================================ -->
        <!-- Legend -->
        <!-- ============================================================ -->
        <mxCell id="legend-box" value="&lt;b&gt;Legend&lt;/b&gt;" style="swimlane;startSize=20;fillColor=#f5f5f5;strokeColor=#cccccc;rounded=1;arcSize=8;fontStyle=1;fontSize=10;swimlaneLine=0;" vertex="1" parent="1">
          <mxGeometry x="20" y="820" width="530" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="legend-green" value="" style="rounded=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;" vertex="1" parent="legend-box">
          <mxGeometry x="10" y="28" width="15" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-green-text" value="Client" style="text;fontSize=9;align=left;" vertex="1" parent="legend-box">
          <mxGeometry x="28" y="27" width="50" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="legend-blue" value="" style="rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;" vertex="1" parent="legend-box">
          <mxGeometry x="85" y="28" width="15" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-blue-text" value="API / Server" style="text;fontSize=9;align=left;" vertex="1" parent="legend-box">
          <mxGeometry x="103" y="27" width="70" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="legend-orange" value="" style="rounded=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;" vertex="1" parent="legend-box">
          <mxGeometry x="180" y="28" width="15" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-orange-text" value="Data Store" style="text;fontSize=9;align=left;" vertex="1" parent="legend-box">
          <mxGeometry x="198" y="27" width="60" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="legend-purple" value="" style="rounded=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=9;" vertex="1" parent="legend-box">
          <mxGeometry x="270" y="28" width="15" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-purple-text" value="External / Integration" style="text;fontSize=9;align=left;" vertex="1" parent="legend-box">
          <mxGeometry x="288" y="27" width="110" height="18" as="geometry"/>
        </mxCell>
        <mxCell id="legend-red" value="" style="rounded=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="legend-box">
          <mxGeometry x="405" y="28" width="15" height="15" as="geometry"/>
        </mxCell>
        <mxCell id="legend-red-text" value="Event / Kafka" style="text;fontSize=9;align=left;" vertex="1" parent="legend-box">
          <mxGeometry x="423" y="27" width="90" height="18" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
