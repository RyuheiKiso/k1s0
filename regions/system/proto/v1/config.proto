syntax = "proto3";

package k1s0.system.config.v1;

option go_package = "github.com/k1s0-platform/system-proto-go/config/v1;configv1";

import "google/protobuf/timestamp.proto";
import "v1/common.proto";

// ConfigService は設定管理サービス。
service ConfigService {
  // GetConfig は指定された namespace と key の設定値を取得する。
  rpc GetConfig(GetConfigRequest) returns (GetConfigResponse);
  // ListConfigs は namespace 内の設定値を一覧取得する。
  rpc ListConfigs(ListConfigsRequest) returns (ListConfigsResponse);
  // GetServiceConfig はサービス名に対応する設定値を一括取得する。
  rpc GetServiceConfig(GetServiceConfigRequest) returns (GetServiceConfigResponse);
  // UpdateConfig は設定値を更新する。
  rpc UpdateConfig(UpdateConfigRequest) returns (UpdateConfigResponse);
  // DeleteConfig は設定値を削除する。
  rpc DeleteConfig(DeleteConfigRequest) returns (DeleteConfigResponse);
  // WatchConfig は設定値の変更を監視する（ストリーミング RPC）。
  rpc WatchConfig(WatchConfigRequest) returns (stream WatchConfigResponse);
}

// --- ConfigEntry ---

message ConfigEntry {
  string id = 1;
  string namespace = 2;
  string key = 3;
  bytes value = 4;
  string description = 5;
  int32 version = 6;
  string created_by = 7;
  string updated_by = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
}

// --- GetConfig ---

message GetConfigRequest {
  string namespace = 1;
  string key = 2;
}

message GetConfigResponse {
  ConfigEntry entry = 1;
}

// --- ListConfigs ---

message ListConfigsRequest {
  string namespace = 1;
  k1s0.system.common.v1.Pagination pagination = 2;
  string search = 3;
}

message ListConfigsResponse {
  repeated ConfigEntry entries = 1;
  k1s0.system.common.v1.PaginationResult pagination = 2;
}

// --- GetServiceConfig ---

message GetServiceConfigRequest {
  string service_name = 1;
}

message GetServiceConfigResponse {
  string service_name = 1;
  repeated ConfigEntry entries = 2;
}

// --- UpdateConfig ---

message UpdateConfigRequest {
  string namespace = 1;
  string key = 2;
  bytes value = 3;
  int32 version = 4;
  string description = 5;
  string updated_by = 6;
}

message UpdateConfigResponse {
  ConfigEntry entry = 1;
}

// --- DeleteConfig ---

message DeleteConfigRequest {
  string namespace = 1;
  string key = 2;
  string deleted_by = 3;
}

message DeleteConfigResponse {
  bool success = 1;
}

// --- WatchConfig ---

message WatchConfigRequest {
  string namespace = 1;
  string key = 2;
}

message WatchConfigResponse {
  string change_type = 1;
  ConfigEntry entry = 2;
}
