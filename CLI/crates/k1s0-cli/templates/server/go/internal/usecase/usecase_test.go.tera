package usecase

import (
	"context"
	"testing"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
{% if has_database %}
	"go.uber.org/mock/gomock"

	"{{ go_module }}/internal/domain/repository"
{% endif %}
	"{{ go_module }}/internal/domain/model"
)

{% if has_database %}
func TestGetByID(t *testing.T) {
	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

	mockRepo := repository.NewMock{{ service_name_pascal }}Repository(ctrl)
	mockRepo.EXPECT().
		FindByID(gomock.Any(), "test-id").
		Return(&model.{{ service_name_pascal }}Entity{
			ID:   "test-id",
			Name: "test",
		}, nil)

	uc := New{{ service_name_pascal }}UseCase(mockRepo)
	result, err := uc.GetByID(context.Background(), "test-id")

	require.NoError(t, err)
	assert.Equal(t, "test-id", result.ID)
	assert.Equal(t, "test", result.Name)
}

func TestGetAll(t *testing.T) {
	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

	mockRepo := repository.NewMock{{ service_name_pascal }}Repository(ctrl)
	mockRepo.EXPECT().
		FindAll(gomock.Any()).
		Return([]*model.{{ service_name_pascal }}Entity{
			{ID: "1", Name: "first"},
			{ID: "2", Name: "second"},
		}, nil)

	uc := New{{ service_name_pascal }}UseCase(mockRepo)
	result, err := uc.GetAll(context.Background())

	require.NoError(t, err)
	assert.Len(t, result, 2)
}

func TestCreate(t *testing.T) {
	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

	entity := &model.{{ service_name_pascal }}Entity{
		Name: "new-entity",
	}

	mockRepo := repository.NewMock{{ service_name_pascal }}Repository(ctrl)
	mockRepo.EXPECT().
		Create(gomock.Any(), entity).
		Return(nil)

	uc := New{{ service_name_pascal }}UseCase(mockRepo)
	err := uc.Create(context.Background(), entity)

	require.NoError(t, err)
}

func TestUpdate(t *testing.T) {
	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

	entity := &model.{{ service_name_pascal }}Entity{
		ID:   "test-id",
		Name: "updated-entity",
	}

	mockRepo := repository.NewMock{{ service_name_pascal }}Repository(ctrl)
	mockRepo.EXPECT().
		Update(gomock.Any(), entity).
		Return(nil)

	uc := New{{ service_name_pascal }}UseCase(mockRepo)
	err := uc.Update(context.Background(), entity)

	require.NoError(t, err)
}

func TestDelete(t *testing.T) {
	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

	mockRepo := repository.NewMock{{ service_name_pascal }}Repository(ctrl)
	mockRepo.EXPECT().
		Delete(gomock.Any(), "test-id").
		Return(nil)

	uc := New{{ service_name_pascal }}UseCase(mockRepo)
	err := uc.Delete(context.Background(), "test-id")

	require.NoError(t, err)
}
{% else %}
func TestGetByID(t *testing.T) {
	uc := New{{ service_name_pascal }}UseCase()
	result, err := uc.GetByID(context.Background(), "test-id")
	assert.NoError(t, err)
	assert.NotNil(t, result)
	assert.Equal(t, "test-id", result.ID)
}

func TestGetAll(t *testing.T) {
	uc := New{{ service_name_pascal }}UseCase()
	result, err := uc.GetAll(context.Background())
	assert.NoError(t, err)
	assert.NotNil(t, result)
	assert.Len(t, result, 0)
}

func TestCreate(t *testing.T) {
	uc := New{{ service_name_pascal }}UseCase()
	entity := &model.{{ service_name_pascal }}Entity{Name: "test"}
	err := uc.Create(context.Background(), entity)
	assert.NoError(t, err)
}

func TestUpdate(t *testing.T) {
	uc := New{{ service_name_pascal }}UseCase()
	entity := &model.{{ service_name_pascal }}Entity{ID: "test-id", Name: "updated"}
	err := uc.Update(context.Background(), entity)
	assert.NoError(t, err)
}

func TestDelete(t *testing.T) {
	uc := New{{ service_name_pascal }}UseCase()
	err := uc.Delete(context.Background(), "test-id")
	assert.NoError(t, err)
}
{% endif %}
