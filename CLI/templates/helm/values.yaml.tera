nameOverride: ""
fullnameOverride: ""

image:
  registry: {{ docker_registry }}
  repository: {{ docker_project }}/{{ service_name }}
  tag: ""
  pullPolicy: IfNotPresent

imagePullSecrets:
  - name: harbor-pull-secret

replicaCount: 2

container:
  port: 8080
{% if api_styles is containing("grpc") %}
  grpcPort: 50051
{% else %}
  grpcPort: null
{% endif %}
  command: []
  args: []

resources:
  requests:
    cpu: 250m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 1Gi

probes:
  liveness:
    httpGet:
      path: /healthz
      port: http
    initialDelaySeconds: 10
    periodSeconds: 15
    failureThreshold: 3
  readiness:
    httpGet:
      path: /readyz
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    failureThreshold: 3

service:
  type: ClusterIP
  port: 80
{% if api_styles is containing("grpc") %}
  grpcPort: 50051
{% else %}
  grpcPort: null
{% endif %}

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

pdb:
  enabled: true
  minAvailable: 1

ingress:
  enabled: false
  ingressClassName: nginx

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  fsGroup: 65532
containerSecurityContext:
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop: ["ALL"]

config:
  mountPath: /etc/app
  data: {}

vault:
  enabled: true
  role: "{{ tier }}"
  secrets:
{% if has_database %}
    - path: "secret/data/k1s0/{{ tier }}/{{ service_name }}/database"
      key: "password"
      mountPath: "/vault/secrets/db-password"
{% endif %}
{% if has_kafka %}
    - path: "secret/data/k1s0/{{ tier }}/{{ service_name }}/kafka"
      key: "password"
      mountPath: "/vault/secrets/kafka-password"
{% endif %}
{% if has_redis %}
    - path: "secret/data/k1s0/{{ tier }}/{{ service_name }}/redis"
      key: "password"
      mountPath: "/vault/secrets/redis-password"
{% endif %}
{% if not has_database and not has_kafka and not has_redis %}
    []
{% endif %}

nodeSelector: {}
tolerations: []
affinity: {}

serviceAccount:
  create: true
  name: ""
  annotations: {}

labels:
  tier: {{ tier }}

kafka:
  enabled: {{ has_kafka }}
  brokers: []

redis:
  enabled: {{ has_redis }}
  host: ""
